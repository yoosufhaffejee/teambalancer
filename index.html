<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Balancer</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>

  <h1>Team Balancer</h1>

  <form>
    <div class="input-row">
      <label for="Name">Name</label>
      <input type="text" name="Name" id="name" />
    </div>
    <div class="input-row">
      <label for="position">Position</label>
      <input list="positions" name="position" id="position" />
      <datalist id="positions"></datalist>
    </div>
    <div class="input-row">
      <label for="rating">Rating</label>
      <input type="number" min="1" max="5" name="rating" id="rating" />
    </div>
    <button>Add</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Position</th>
        <th>Rating</th>
        <th> <button onclick="Calc()">Calculate</button> </th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <br>
  <br>

  <div hidden id="t1">

    <h2 style="text-align: center">Team 1</h2>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Position</th>
          <th>Rating</th>
        </tr>
      </thead>
      <tbody id="Team1Body"></tbody>
    </table>

  </div>

  <div hidden id="t2">

    <h2 style="text-align: center">Team 2</h2>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Position</th>
          <th>Rating</th>
        </tr>
      </thead>
      <tbody id="Team2Body"></tbody>
    </table>

  </div>

  <script>

    class player {
      constructor(name, position, rating) {
        this.name = name;
        this.position = position;
        this.rating = rating;
      }
    }

    var positions = new Array();
    positions[0] = 'GK';
    positions[1] = 'DEF';
    positions[2] = 'MID';
    positions[3] = 'ATT';

    const players = [new player("Yoosuf Haffejee", positions[3], 5),
    new player("Luqmaan Haffejee", positions[1], 4),
    new player("Muhammad Haffejee", positions[1], 3),
    new player("Ahmed Haffejee", positions[3], 4),
    new player("Ar Chothia", positions[2], 5),
    new player("Mumu Chothia", positions[2], 4),
    new player("Eesa Chothia", positions[3], 4),
    new player("Usaamah Chothia", positions[0], 5),
    new player("Shezaad Khan", positions[1], 3),
    new player("Momo Khan", positions[2], 4),
    new player("Dadz Wadee", positions[1], 5),
    new player("Mutasim Haffejee", positions[1], 3),
    new player("Ash Bulbulia", positions[3], 3),
    new player("Zak Limbada", positions[0], 3)];

    const form = document.querySelector("form");
    const tbody = document.querySelector("tbody");
    const table = document.querySelector("table");
    const table2 = document.getElementById("Teams");

    var options = '';

    for (var i = 0; i < positions.length; i++) {
      options += '<option value="' + positions[i] + '" />';
    }

    document.getElementById('positions').innerHTML = options;

    function Add(e) {

      var name = document.getElementById("name").value;
      var position = document.getElementById("position").value;
      var rating = document.getElementById("rating").value;

      if (positions.includes(position)) {
        e.preventDefault();

        players.push(new player(name, position, rating));

        tbody.innerHTML += `
          <tr>
              <td>${name}</td>
              <td>${position}</td>
              <td>${rating}</td>
              <td><button class="deleteBtn">Delete</button></td>
          </tr>
        `;

        name = " ";
        position = " ";
        rating = " ";
      }
    }

    function Init(item) {

      tbody.innerHTML += `
      <tr>
          <td>${item.name}</td>
          <td>${item.position}</td>
          <td>${item.rating}</td>
          <td><button class="deleteBtn">Delete</button></td>
      </tr>
    `;
    }

    players.forEach(Init);

    function Delete(e) {

      var name = e.path[2].cells[0].innerHTML;
      var position = e.path[2].cells[1].innerHTML;
      var rating = e.path[2].cells[2].innerHTML;

      if (!e.target.classList.contains("deleteBtn")) {
        return;
      }

      const btn = e.target;
      btn.closest("tr").remove();

      var index = players.findIndex(object => {
        return object.name === name;
      });

      if (index !== -1) {
        players.splice(index, 1);
      }
    }

    const sortByRating = (a, b) => {
      if (a.rating < b.rating) {
        return -1
      }

      if (a.apples > b.apples) {
        return 1
      }

      return 0
    }

    function Calc() {
      var totalRating = 0;
      players.forEach(player => {
        totalRating += player.rating;
      });

      const T1 = document.getElementById("t1");
      const T2 = document.getElementById("t2");
      const T1B = document.getElementById("Team1Body");
      const T2B = document.getElementById("Team2Body");

      var Team1Count = 0;
      var Team2Count = 0;
      var Team1Rating = 0;
      var Team2Rating = 0;

      var Team1 = [];
      var Team2 = [];

      while (T1B.rows.length > 0) {
        T1B.deleteRow(0);
      }

      while (T2B.rows.length > 0) {
        T2B.deleteRow(0);
      }

      gk = new Array();
      def = new Array();
      mid = new Array();
      att = new Array();

      var coinFlip = Math.floor(Math.random() * 2);
      var picker;

      if (coinFlip === 1) {
        picker = "Team1";
      }
      else {
        picker = "Team2";
      }

      // Split players into groups by position
      players.forEach(player => {
        if (player.position == "GK") {
          gk.push(player);
        }

        if (player.position == "DEF") {
          def.push(player);
        }

        if (player.position == "MID") {
          mid.push(player);
        }

        if (player.position == "ATT") {
          att.push(player);
        }
      });

      // Order player position groups by rating
      //gk.sort(sortByRating);
      //def.sort(sortByRating);
      //mid.sort(sortByRating);
      //att.sort(sortByRating);

      // Store the origanl array length so it does not change when we remove elements
      GK_Original_Length = gk.length;
      DEF_Original_Length = def.length;
      MID_Original_Length = mid.length;
      ATT_Original_Length = att.length;

      // Pick GK
      for (let i = 0; i < GK_Original_Length; i++) {

        var random = Math.floor(Math.random() * gk.length);
        var selectedPlayer = gk[random];

        if (picker === "Team1") {
          Team1.push(selectedPlayer);
          picker = "Team2";
        }
        else {
          Team2.push(selectedPlayer);
          picker = "Team1"
        }

        var PlayerIndex = gk.findIndex(p => {
          return p.name === selectedPlayer.name;
        });

        gk.splice(PlayerIndex, 1)
      }

      // Pick DEF
      for (let i = 0; i < DEF_Original_Length; i++) {

        var random = Math.floor(Math.random() * def.length);
        var selectedPlayer = def[random];

        if (picker === "Team1") {
          Team1.push(selectedPlayer);
          picker = "Team2";
        }
        else {
          Team2.push(selectedPlayer);
          picker = "Team1"
        }

        var PlayerIndex = def.findIndex(p => {
          return p.name === selectedPlayer.name;
        });

        def.splice(PlayerIndex, 1)
      }

      // Pick MID
      for (let i = 0; i < MID_Original_Length; i++) {

        var random = Math.floor(Math.random() * mid.length);
        var selectedPlayer = mid[random];

        if (picker === "Team1") {
          Team1.push(selectedPlayer);
          picker = "Team2";
        }
        else {
          Team2.push(selectedPlayer);
          picker = "Team1"
        }

        var PlayerIndex = mid.findIndex(p => {
          return p.name === selectedPlayer.name;
        });

        mid.splice(PlayerIndex, 1)
      }

      // Pick ATT
      for (let i = 0; i < ATT_Original_Length; i++) {

        var random = Math.floor(Math.random() * att.length);
        var selectedPlayer = att[random];

        if (picker === "Team1") {
          Team1.push(selectedPlayer);
          picker = "Team2";
        }
        else {
          Team2.push(selectedPlayer);
          picker = "Team1"
        }

        var PlayerIndex = att.findIndex(p => {
          return p.name === selectedPlayer.name;
        });

        att.splice(PlayerIndex, 1)
      }

      // Show the resultant tables
      T1.hidden = false;
      T2.hidden = false;

      // Add footer info to resultant team 1 table
      Team1.forEach(player => {

        Team1Rating += player.rating;
        Team1Count++;

        T1B.innerHTML += `
      <tr>
          <td>${player.name}</td>
          <td>${player.position}</td>
          <td>${player.rating}</td>
      </tr>
    `;
      });

      T1B.innerHTML += `
      <tr>
          <td><b> Count: ${Team1Count} </b></td>
          <td></td>
          <td> <b>${Team1Rating}</b> </td>
      </tr>
    `;

      // Add footer info to resultant team 1 table
      Team2.forEach(player => {

        Team2Rating += player.rating;
        Team2Count++;

        T2B.innerHTML +=
          `<tr>
          <td>${player.name}</td>
          <td>${player.position}</td>
          <td>${player.rating}</td>
      </tr>`;
      });

      T2B.innerHTML +=
        `<tr>
        <td><b> Count: ${Team2Count} </b></td>
          <td></td>
          <td> <b>${Team2Rating}</b> </td>
      </tr>`;
    }

    form.addEventListener("submit", Add);
    table.addEventListener("click", Delete);
    //table2.addEventListener("click", Calc)

  </script>

</body>

</html>